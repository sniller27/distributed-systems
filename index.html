<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Artist databank</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script>
			var artists = [];
			var artist;
		$(document).ready(function(){
			//GLOBAL VARIABLES
			var artistname, artistbplace, artistbday, artistfavorite, artistsearchword, artisttableupdate;

			//VALIDATION
			function validateArtist(){
				if (!artistname) {
					return false;
				}else {
					return true;
				}
			}

			//UPDATE TABLE
			function updateTable(artistlist){
				artistsearchword = $('#artistsearch').val();
			    var tabledata = "";

				for (var i = 0; i < artistlist.length; i++) {

					if (artistlist[i].name.includes(artistsearchword)) {
						tabledata += "<tr>";
						for (var key in artistlist[i]) {
						  if (artistlist[i].hasOwnProperty(key)) {
						    // console.log(key + " -> " + artistlist[i][key]);
						    if (key == 'favoriteArtist') {
						    	var ischecked = "";
						    	if (artistlist[i][key] == true) {
						    		ischecked = " checked";
						    	}
						    	tabledata += "<td><input type='checkbox' value='"+artistlist[i][key]+"' id='"+artistlist[i]['id']+"'"+ischecked+"></td>";
						    }else {
						    	tabledata += "<td>"+artistlist[i][key]+"</td>";
						    }
						  }
						}
						tabledata += "</tr>";
					}
				}
			    $("#artisttable tbody").html(tabledata);
			}

			//DETECT TABLE CHANGE
			$("table#artisttable.table tbody").change(function(e){
				var chagedartistid = $(e.target).get(0).id;
				// console.log(chagedartistid);
				var currentbool = artists[chagedartistid-1].favoriteArtist;
				// console.log(artists[chagedartistid-1].favoriteArtist);
				artists[chagedartistid-1].favoriteArtist = !currentbool;
			});

			//NEW ARTIST
		    $("#addartistform").submit(function(){
		    	artistname = $('#artistnamefield').val();
		    	artistbplace = $('#artistbirthplacefield').val();
		    	artistbday = $('#artistbirthdatefield').val();
		    	artistfavorite = $('#artistfavoritecheckbox').is(':checked');
				
				if (validateArtist()) {
					var favoritebool = artistfavorite ? true : false;

					//generate artist ID
					var genid = artists.length + 1;

			    	artist = {
			    		id: genid,
			    		name:artistname, 
			    		birthPlace:artistbplace, 
			    		birthDate:artistbday, 
			    		favoriteArtist:favoritebool
			    	};

			    	//add to array
			        artists.push(artist);

				    updateTable(artists);

				    console.log(JSON.stringify(artists));
				    return false;

				}

			});

			//SEARCH
			$("#artistsearch").keyup(function(){
			    updateTable(artists);
			});
		});
	</script>
</head>
<body>
	<div class="container">
		<div class="row">
			<div class="col-sm-6">
				<form action="" id="addartistform">
					<h2>Add new artist:</h2>

					<div class="form-group">
						<label for="artistnamefield">Artist name:</label>
						<input type="text" class="form-control" id="artistnamefield">
					</div>
					<div class="form-group">
						<label for="artistbirthplacefield">Artist birthplace:</label>
						<input type="text" class="form-control" id="artistbirthplacefield">
					</div>
					<div class="form-group">
						<label for="artistbirthdatefield">Artist birthdate:</label>
						<input type="date" class="form-control" id="artistbirthdatefield">
					</div>
					<div class="checkbox">
						<label><input type="checkbox" value="" id="artistfavoritecheckbox">Favorite artist</label>
					</div>

					<input type="submit" value="Add artist" class="btn btn-success">
				</form>
			</div>			
			<div class="col-sm-6">
				<h2>List of artists:</h2>
				<div class="form-group">
					<label for="artistsearch">Artist name:</label>
					<input type="text" class="form-control" id="artistsearch" placeholder="Search">
				</div>
				<!-- <ul id="artisttable"></ul> -->
				<table class="table" id="artisttable">
					<thead>
						<tr>
							<th>Artist ID:</th>
							<th>Artist name:</th>
							<th>Artist birthplace:</th>
							<th>Artist birthdate:</th>
							<th>Favorite artist:</th>
						</tr>
					</thead>
					<tbody>
						
					</tbody>
				</table>
			</div>			
		</div>
	</div>
</body>
</html>